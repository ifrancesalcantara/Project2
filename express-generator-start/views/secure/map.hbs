{{!-- <span id="userHomeLng" display="none" type='hidden'>{{userHomeLocation.lng}}</span>
<span id="userHomeLat" display="none" type='hidden'>{{userHomeLocation.lat}}</span> --}}


<span id="userHomeLng">{{this.lng}}</span>
<span id="userHomeLat">{{this.lat}}</span>

<div id="map"></div>
<pre id='info'></pre>

<form class="add-comment-form" action='/comment' method='POST'>

  <input type='text' name='title' value="title" required>

  <input type='text' name='text' value="text">

  <input id="newCommentLng" type='text' name='lng' required>

  <input id="newCommentLat" type='text' name='lat' required>


  <button type='submit'>Submit</button>
</form>

<script src='https://unpkg.com/mapbox@1.0.0-beta9/dist/mapbox-sdk.min.js'></script>
<script>
    var client = new MapboxClient('pk.eyJ1IjoiaXZhbmZyYWwiLCJhIjoiY2szOTFzMm9pMGJteTNtcDI3aDJua2s5MSJ9.y5iUZoRKCEeCny5m2sJrlg');
    const map = document.querySelector("#map")
    const query=""
    const commentTitle = "Home";
    const commentText = "A good school.";
    var userHomeLong = document.querySelector("#userHomeLng").innerHTML
    var userHomeLat = document.querySelector("#userHomeLat").innerHTML
    const lastMarker = []
    var isAddCommentDisplayed = false;

    var popup = new mapboxgl.Popup()
    .setHTML(`<h3>${commentTitle}</h3>`);

    map.style.height="80vh";
    map.style.width="100vw";

    client.geocodeForward(query, function(err, data, res) {
    mapboxgl.accessToken = "pk.eyJ1IjoiaXZhbmZyYWwiLCJhIjoiY2szOTFzMm9pMGJteTNtcDI3aDJua2s5MSJ9.y5iUZoRKCEeCny5m2sJrlg" //!!! .env
    
        const map = new mapboxgl.Map({
            container: 'map', // HTML container id
            style: 'mapbox://styles/mapbox/streets-v9', // style URL
            center: [userHomeLong, userHomeLat],
            zoom: 13
        });

        const marker = new mapboxgl.Marker()
        .setLngLat([userHomeLong, userHomeLat])
        .setPopup(popup)
        .addTo(map);

        map.on('click', function (e) {
            const newCommentLng = e.lngLat.wrap().lng
            const newCommentLat = e.lngLat.wrap().lat

            const newCommentLngInput = document.querySelector("#newCommentLng");
            const newCommentLatInput = document.querySelector("#newCommentLat");
            newCommentLngInput.value = newCommentLng
            newCommentLatInput.value = newCommentLat

            const markerOnClick = new mapboxgl.Marker()
                .setLngLat([newCommentLng, newCommentLat])
                .addTo(map);
            if(lastMarker[0]){
                lastMarker[0].remove();
                lastMarker.splice(0,1)
            }
            lastMarker.push(markerOnClick)
        });


        


        const addCommentIcon = document.querySelector(".add-img-plus");
        addCommentIcon.addEventListener("click",()=>{
            if(isAddCommentDisplayed){
                const commentForm = document.querySelector(".add-comment-form");
                /*commentForm.style.visibility = "hidden";*/
                commentForm.style.height = "0vh";
                isAddCommentDisplayed = false;
            }
            else {
                const commentForm = document.querySelector(".add-comment-form");
                /*commentForm.style.visibility = "visible";*/
                commentForm.style.height = "10vh";
                isAddCommentDisplayed = true;
            }
        })
    });


</script>

{{!-- navigator.geolocation.getCurrentPosition((posObj) => console.log(posObj))  --}}

