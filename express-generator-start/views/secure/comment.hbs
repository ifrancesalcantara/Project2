<h3>{{this.title}}</h3>

<p>{{this.text}}</p>

<p>By: {{this.creatorId.username}}</p>

<p id="currentUser" hidden>{{this.currentUserUsername}}</p>
<p id="commentId" hidden>{{this._id}}</p>

<form action="/reply/{{this._id}}" method="POST">
    <input type="text" name="text" placeholder="Reply" id="" required>
    {{!-- <input type="text" name="image_url" placeholder="Add an image" id=""> IF we have time --}}
    <input type="text" name="creatorUsername" id="" value={{this.creatorId.username}} hidden>
    <input type="text" name="date" id="replyDate" hidden>
    <button type="submit">Reply</button>
</form>


<div id="replies">
    <div class="reply">
        {{#each this.replies}}
            <p class="replyDateDisplayed">{{this.date}}</p>
            <p class="creatorUsername">{{this.creatorUsername}}</p>
            <p class="replyId" hidden>{{this._id}}</p>
            <p class="replyText"> {{this.text}}</p>
        {{/each}}
    </div>
</div>


<script>
    const dateInput = document.querySelector("#replyDate")
    const dateDisplayed = document.querySelectorAll(".replyDateDisplayed")
    const currentUser = document.querySelector("#currentUser").innerHTML
    const allReplyUsernames = document.querySelectorAll(".creatorUsername")
    const replyIds = document.querySelectorAll(".replyId")
    const commentId = document.querySelector("#commentId").innerHTML
    

    dateInput.value = new Date()
    
    dateDisplayed.forEach((dateDisplayed, index)=>{
        var dateToDisplay = dateDisplayed.innerHTML.split(" ")
        dateToDisplay.splice(0, 1)
        dateToDisplay.splice(3)
        dateDisplayed.innerHTML = dateToDisplay    

        console.log(currentUser, "is ", allReplyUsernames[index].innerHTML, "?")
        if(currentUser === allReplyUsernames[index].innerHTML) {
            const deleteDiv = document.createElement("div")
            deleteDiv.innerHTML= (`<form method="Post" action="/reply/delete/${replyIds[index].innerHTML}/${commentId}"><button type="submit">Delete</button></form>`).trim()
            dateDisplayed.appendChild(deleteDiv)
        }
    })



</script>
